---
interface TocItem {
  id: string;
  label: string;
}

interface Props {
  items: TocItem[];
}

const { items } = Astro.props;
---

<nav class="py-8 px-6">
  <h3 class="text-sm font-semibold text-slate-900 mb-4">On this page</h3>
  <ul class="space-y-2" id="toc-list">
    {
      items.map((item) => (
        <li>
          <a
            href={`#${item.id}`}
            class="toc-link block text-sm text-gray-600 hover:text-primary transition-colors py-1"
            data-target={item.id}
          >
            {item.label}
          </a>
        </li>
      ))
    }
  </ul>
</nav>

<script>
  // Highlight active section in TOC
  function updateActiveSection() {
    const sections = document.querySelectorAll("section[id]");
    const tocLinks = document.querySelectorAll(".toc-link");

    let currentActive = "";

    sections.forEach((section) => {
      const rect = section.getBoundingClientRect();
      if (rect.top <= 100 && rect.bottom >= 100) {
        currentActive = section.id;
      }
    });

    tocLinks.forEach((link) => {
      const target = link.getAttribute("data-target");
      if (target === currentActive) {
        link.classList.add("text-primary", "font-semibold");
        link.classList.remove("text-gray-600");
      } else {
        link.classList.remove("text-primary", "font-semibold");
        link.classList.add("text-gray-600");
      }
    });
  }

  // Update on scroll
  if (typeof window !== "undefined") {
    window.addEventListener("scroll", updateActiveSection);
    window.addEventListener("load", updateActiveSection);
  }
</script>

